---
title: 'IDEAIS: Análisis de las características de los asistentes virtuales'
author: "Carlos Granell, Paola Pesántez et al."
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    df_print: paged
    toc: yes
  word_document:
    toc: yes
urlcolor: blue
---

## Required libraries

```{r load_libraries, echo=TRUE, message=FALSE, warning=FALSE}
library(here)
library(tidyverse)
library(kableExtra)
library(DT)
library(ggrepel)

```

## Data 

```{r load_data, echo=FALSE}
papers2010_2019 <- readRDS(file = here("data", "papers2010_2019.rda"))
data_av1 <- readRDS(file = here("data", "data_av1.rda"))
data_av2 <- readRDS(file = here("data", "data_av2.rda"))
data_geo <- readRDS(file = here("data", "data_geo.rda"))

```

```{r all_data, echo=FALSE}
all_data <- 
  papers2010_2019 %>%
  inner_join(data_av1, by="id") %>%
  inner_join(data_geo, by="id") %>%
  select(id, year, av_app_norm, av_application, av_name, av_place, av_status, av_arch, av_platform,
         geo_goal_norm, geo_goal, geo_sources, geo_tech, geo_inputmode, geo_outputmode, geo_standards, 
         geo_process, geo_processtype) %>%
  arrange(desc(year))

  
```


```{r echo=FALSE}
all_data %>%
  select(ID = id,
         `Año` = year,
         `Aplicaciones` = av_application,
         `Nombre AV` = av_name,
         `Lugar`= av_place,
         `Estado` = av_status,
         `Arqui.` = av_arch,
         `Plataform` = av_platform,
         `[Geo] Propósito` = geo_goal,
         `[Geo] Fuentes` = geo_sources,
         `[Geo] Tecno` = geo_tech,
         `[Geo] Entrada` =geo_inputmode,
         `[Geo] Salida` = geo_outputmode,
         `[Geo] Estandar?` = geo_standards,
         `[Geo] Process?` = geo_process,
         `[Geo] Tipo process` = geo_processtype) %>%
  arrange(desc(`Año`)) %>%
  datatable(rownames = FALSE,
            filter = "top",
            class = "table-bordered table-condensed hover",
            extensions = c("Buttons"),
            options = list(
              pageLength = 10, #autoWidth = TRUE,
              dom = 'Blfrtip',  # https://datatables.net/reference/option/dom
              buttons = c('copy', 'csv', 'excel', 'pdf', 'print')
            )
  )
```



## Results


```{r echo=FALSE}
papers <- 
  papers2010_2019 %>% 
  inner_join(data_av1, by="id") %>%
  arrange(id)

n_papers <- nrow(papers)

```



### Temporal distribution of virtual assistants according to _av_status_

```{r echo=FALSE}
papers %>%
  group_by(av_status) %>% 
  summarise(n = n()) %>%
  mutate(proportion  = n / n_papers, 
         proportion_lbl = paste0(round(proportion*100,0), "%")) %>%
  arrange(n) %>%
  select(`Estado de desarrollo AV` = av_status,
         `N` = n,
         `%`= proportion_lbl) %>%
  knitr::kable(format="html", escape = T, booktabs = TRUE) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))

```


_What AVs do they reach the status of operational implementation?_
```{r av_status, echo=FALSE }
# W
papers %>%
  filter(av_status=="IMPLEMENTACION-OPERATIVO") %>%
  select(id, av_name)

```



```{r echo=FALSE}
papers %>%
  group_by(year, av_status) %>% 
  summarise(n = n()) %>%
  mutate(total_year = sum(n),
         proportion_year = n/total_year,
         proportion_year_lbl = paste0(round(proportion_year*100,0), "%")) %>%
  ggplot(aes(x=year, y=n, fill=av_status)) + 
  geom_bar(stat="identity") +
  geom_text(aes(label=proportion_year_lbl), size=2.7, position=position_stack(vjust = 0.5)) +
  # stat_summary(fun.y = sum, aes(label=..y.., group=year), geom = "text", vjust=-.2) +
  labs(title="Distribución temporal de los AV coloreados por 'av_status'",
    x="", 
    y="# de estudios") +
  scale_y_continuous(breaks=seq(0,10,by=1)) +
  scale_x_continuous(breaks = seq(2010,2020, by=1)) +
  guides(fill=guide_legend(title="Estado desarrollo", nrow=4)) + # modify legend title
  theme_minimal() + 
  theme(panel.grid.minor = element_blank()) +
  theme(panel.background = element_blank()) +
  theme(legend.title = element_text(size=9),
        legend.position = "bottom")

ggsave(here("figs", "fig03.png"))

```

### Temporal distribution of virtual assistants considering _av_arch_ vs _av_status_


```{r echo=FALSE}

papers %>%
  select(year, av_arch, av_status) %>%
  group_by(year, av_arch, av_status) %>%
  summarise(n = n()) %>%
  ggplot(aes(x=year, y=av_arch, color=av_status)) +
  geom_point(aes(size=n*4),  alpha=.5, na.rm = TRUE) +
  geom_label_repel(aes(label=n, color=av_status), size=2.5, na.rm = TRUE) +
  scale_x_continuous(breaks = seq(2010,2020, by=1)) +
  scale_size_area(max_size=12) +
  labs(#title="Temporal distribution of studies \naccording to technical approach",
       x="Year", 
       y="Technical approach") +
  # Which legend to show
  guides(color="legend",size = "none", label="none") +
  guides(color=guide_legend(title="Development status", nrow=4))+ 
  theme_minimal() + 
  theme(panel.grid.minor = element_blank()) +
  theme(panel.background = element_blank()) +
  theme(legend.title = element_text(size=9),
        legend.position = "bottom")

ggsave(here("figs", "fig04.png"), width = 16, units = "cm")
```


### How many AV are named?

```{r echo=FALSE}
named <- 
  papers %>%
  select(id, av_name, year, av_app_norm, av_application) %>%
  filter(!is.na(av_name))

cat(nrow(named))

```

Número de asistentes virtual con nombre `r  round(nrow(names)/n_papers*100,0)`%.

### AV's application domains vs  _geo_goals_

```{r data_geo, echo=FALSE}
papers <- 
  all_data

n_papers <- length(unique(papers$id))
```

```{r echo=FALSE}
papers %>%
  select(ID = id,
         `Año` = year,
         `App domain`= av_app_norm,
         `Geo goal`= geo_goal_norm,
         `Aplicaciones` = av_application,
         `Propósito geo` = geo_goal ) %>%
  arrange(desc(`Año`)) %>%
  datatable(rownames = FALSE,
            filter = "top",
            class = "table-bordered table-condensed hover",
            extensions = c("Buttons"),
            options = list(
              pageLength = 10, #autoWidth = TRUE,
              dom = 'Blfrtip',  # https://datatables.net/reference/option/dom
              buttons = c('copy', 'csv', 'excel', 'pdf', 'print')
            )
  )
```


```{r echo=FALSE}
table(papers$av_app_norm)

```





### What is the most used platform in AV? Examine _av_platform_ vs _av_arch_...

```{r platforms_data, echo=FALSE}

platforms <- 
  select(papers, id, year, av_platform, av_arch) %>%
  filter(!is.na(av_platform))
         
no_platforms <- nrow(platforms)

```

Out of `r n_papers`, the implementated platform is mentioned in `r no_platforms`  studies, which is about `r round(no_platforms/n_papers*100, 0)`%.

```{r platforms_table, echo=FALSE}
platforms %>%
  arrange(desc(year)) %>%
  select(ID=id,
         `Año`=year,
         `Plataforma de implementación` = av_platform,
         `Aproximación técnica` = av_arch) %>%
  knitr::kable(format="html", escape = T, booktabs = TRUE) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```



## Runtime environment description


```{r session_info, echo=FALSE}
devtools::session_info(include_base = TRUE)
```
