---
title: 'Analysis of the visual assisstants in the eligible papers'
author: "Carlos Granell"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    df_print: paged
    toc: yes
  word_document:
    toc: yes
urlcolor: blue
---


```{r setup, include=FALSE, eval=TRUE}
knitr::opts_chunk$set(echo = FALSE)
```

This document is an exploratory analysis of the virtual assisstants included in the eligible papers. It's part of a collaborative scoping review activity as part of the [IDEAIS project](https://sites.google.com/view/redideais).


## Required libraries

```{r load_libraries, echo=TRUE, message=FALSE, warning=FALSE}
library(here)
library(tidyverse)
library(kableExtra)
library(DT)
library(ggrepel)

# just in case
set.seed(nchar("IDEAIS - scoping review paper"))
```

## Data 

```{r load_data}
papers2010_2019 <- readRDS(file = here("data", "papers2010_2019.rda"))
data_av1 <- readRDS(file = here("data", "data_av1.rda"))
data_av2 <- readRDS(file = here("data", "data_av2.rda"))
data_geo <- readRDS(file = here("data", "data_geo.rda"))

```

```{r all_data_join}
all_data <- 
  papers2010_2019 %>%
  inner_join(data_av1, by="id") %>%
  inner_join(data_geo, by="id") %>%
  select(id, year, av_app_norm, av_application, av_name, av_place, av_status, av_arch, av_platform,
         geo_goal_norm, geo_goal, geo_sources, geo_tech, geo_inputmode, geo_outputmode, geo_standards, 
         geo_process, geo_processtype)

```


```{r all_data_table}
all_data %>%
  select(ID = id,
         Year = year,
         `[AV] Application` = av_application,
         `[AV] Name` = av_name,
         `[AV] Place`= av_place,
         `[AV] Dev. status` = av_status,
         `[AV] Arch.` = av_arch,
         `[AV] Platform` = av_platform,
         `[Geo] Goal` = geo_goal,
         `[Geo] Sources` = geo_sources,
         `[Geo] Tech` = geo_tech,
         `[Geo] Input` =geo_inputmode,
         `[Geo] Output` = geo_outputmode,
         `[Geo] Standards?` = geo_standards,
         `[Geo] Process?` = geo_process,
         `[Geo] Process type` = geo_processtype) %>%
  arrange(desc(Year)) %>%
  datatable(rownames = FALSE,
            filter = "top",
            class = "table-bordered table-condensed hover",
            extensions = c("Buttons"),
            options = list(
              pageLength = 10, #autoWidth = TRUE,
              dom = 'Blfrtip',  # https://datatables.net/reference/option/dom
              buttons = c('copy', 'csv', 'excel', 'pdf', 'print')
            )
  )
```



## Results on the characteristics of the virtual assistants


```{r av_stats}
papers <- 
  papers2010_2019 %>% 
  inner_join(data_av1, by="id") %>%
  arrange(id)

n_papers <- nrow(papers)

```


### Input/output mode




### Temporal distribution of virtual assistants according to _av_status_

```{r echo=FALSE}
papers %>%
  group_by(av_status) %>% 
  summarise(n = n()) %>%
  mutate(proportion  = n / n_papers, 
         proportion_lbl = paste0(round(proportion*100,0), "%")) %>%
  arrange(n) %>%
  select(`Development stage of virtual assisstants` = av_status,
         `N` = n,
         `%`= proportion_lbl) %>%
  knitr::kable(format="html", escape = T, booktabs = TRUE) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))

```


_What AVs do they reach the status of operational implementation?_
```{r av_status, echo=FALSE }
# W
papers %>%
  filter(av_status=="Implementation") %>%
  select(id, av_name)

```



```{r echo=FALSE}
# papers %>%
#   group_by(year, av_status) %>% 
#   summarise(n = n()) %>%
#   mutate(total_year = sum(n),
#          proportion_year = n/total_year,
#          proportion_year_lbl = paste0(round(proportion_year*100,0), "%")) %>%
#   ggplot(aes(x=year, y=n, fill=av_status)) + 
#   geom_bar(stat="identity") +
#   geom_text(aes(label=proportion_year_lbl), size=2.7, position=position_stack(vjust = 0.5)) +
#   # stat_summary(fun.y = sum, aes(label=..y.., group=year), geom = "text", vjust=-.2) +
#   labs(title="Distribución temporal de los AV coloreados por 'av_status'",
#     x="", 
#     y="# de estudios") +
#   scale_y_continuous(breaks=seq(0,10,by=1)) +
#   scale_x_continuous(breaks = seq(2010,2020, by=1)) +
#   guides(fill=guide_legend(title="Estado desarrollo", nrow=4)) + # modify legend title
#   theme_minimal() + 
#   theme(panel.grid.minor = element_blank()) +
#   theme(panel.background = element_blank()) +
#   theme(legend.title = element_text(size=9),
#         legend.position = "bottom")
# 
# ggsave(here("figs", "fig03.png"))

```

### Temporal distribution of virtual assistants considering _av_arch_ vs _av_status_


```{r echo=FALSE}
papers %>%
  select(year, av_arch, av_status) %>%
  group_by(year, av_arch, av_status) %>%
  summarise(n = n()) %>%
  ggplot(aes(x=year, y=av_arch, color=av_status, group=av_status)) +
  geom_point(aes(size=n*4),  alpha=.5, na.rm = TRUE) +
  geom_label_repel(aes(label=n, color=av_status), size=2.5, na.rm = TRUE) +
  scale_x_continuous(breaks = seq(2010,2020, by=1)) +
  scale_size_area(max_size=12) +
  labs(#title="Temporal distribution of studies \naccording to technical approach",
       x="Year", 
       y="Technical approach") +
  # Which legend to show
  guides(color="legend", size = "none", label= "none") +
  guides(color=guide_legend(title="Development status", nrow=2))+ 
  theme_minimal() + 
  theme(panel.grid.minor = element_blank()) +
  theme(panel.background = element_blank()) +
  theme(legend.title = element_text(size=9),
        legend.position = "bottom")

ggsave(here("figs", "fig05-bubbles.png"), width = 16, units = "cm")
```


### types of platforms

```{r}
platforms <- 
  papers %>%
  select(av_platform) %>%
  group_by(av_platform) %>%
  summarise(n = n()) %>%
  arrange(n)
```


### How many AV are named?

```{r echo=FALSE}
named <- 
  papers %>%
  select(id, av_name, year, av_app_norm, av_application) %>%
  filter(!is.na(av_name))

cat(nrow(named))

```

Number of named smart digital assisstants `r  round(nrow(names)/n_papers*100,0)`%.

### Table of all articles where categories of _application domains_ vs  _geo_goals_ are grouped, together with descriptions and research lines.

```{r data_geo, echo=FALSE}
app_domains = c("Disaster management", 
                "Education", 
                "Education; Entertaintment", 
                "Healthcare",
                "Recommendation", 
                "Tourism", 
                "Tourism; Cultural heritage", 
                "Tourism; Entertaintment")
others = c("Conversation", 
           "Linguistic", 
           "Navigation")

table_researchareas <-
  data_av2 %>%
  group_by(id) %>% arrange(av_researchareas) %>%
  summarise(av_areas  = paste(stringr::str_to_sentence(av_researchareas), collapse =", ")) %>%
  arrange(id)

  
table_papers <- 
  papers2010_2019 %>%
  inner_join(data_av1, by="id") %>%
  inner_join(data_geo, by="id") %>%
  inner_join(table_researchareas, by="id") %>%
  select(av_app_norm, geo_goal_norm, year, id, av_application, geo_goal, av_areas) %>%
  mutate(ref = paste0("[", id, "] ", year),
         group = ifelse(av_app_norm %in% app_domains, 1, 2)) %>%
  arrange(group, av_app_norm, year)


n_papers <- length(unique(table_papers$id))
```

```{r echo=FALSE}
table_papers  %>%
  select(`G`= group,
         `App domain`= av_app_norm,
         `Geo goal`= geo_goal_norm,
         `Ref - Year` = ref,
         `App desc` = av_application,
         `Geo desc` = geo_goal,
         `Research areas`= av_areas) %>%
  datatable(rownames = FALSE,
            filter = "top",
            class = "table-bordered table-condensed hover",
            extensions = c("Buttons"),
            options = list(
              pageLength = 10, #autoWidth = TRUE,
              dom = 'Blfrtip',  # https://datatables.net/reference/option/dom
              buttons = c('copy', 'csv', 'excel', 'pdf', 'print')
            )
  )


table_papers  %>%
  select(`G`= group,
         `App domain`= av_app_norm,
         `Geo goal`= geo_goal_norm,
         `Ref - Year` = ref,
         `App desc` = av_application,
         `Geo desc` = geo_goal,
         `Research areas`= av_areas) %>%
  knitr::kable(format="html", escape = T, booktabs = TRUE) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive")) %>%
  collapse_rows(columns = 1:2, valign = "top")
```




### What is the most used platform in AV? Examine _av_platform_ vs _av_arch_...

```{r platforms_data, echo=FALSE}

platforms <- 
  select(papers, id, year, av_platform, av_arch) %>%
  filter(!is.na(av_platform))
         
no_platforms <- nrow(platforms)

```

Out of `r n_papers`, the implementated platform is mentioned in `r no_platforms`  studies, which is about `r round(no_platforms/n_papers*100, 0)`%.

```{r platforms_table, echo=FALSE}
platforms %>%
  arrange(desc(year)) %>%
  select(ID=id,
         `Año`=year,
         `Plataforma de implementación` = av_platform,
         `Aproximación técnica` = av_arch) %>%
  knitr::kable(format="html", escape = T, booktabs = TRUE) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))
```



## Runtime environment description


```{r session_info, echo=FALSE}
devtools::session_info(include_base = TRUE)
```
